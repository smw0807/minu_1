https://smw0807.notion.site/2a76de34082c4bb2afde92b7f8790510

# 13-1 메시징 시스템의 기초

메시징 시스템에 대해 고려해야 할 네 가지 기본 요소가 있다.

- 단방향 혹은 요청/응답 교환과 같은 통신방향
- 내용을 결정하는 메시지의 목적
- 컨텍스트 안(동기식) 또는 컨텍스트 밖(비동기식)으로 송수신할 수 있는 메시지 타이밍
- 직접 또는 브로커를 통해 발생할 수 있는 메시지 전달 유형

## 13-1-1 단방향 대 요청/응답 패턴

메시징 시스템에서 가장 기본적인 측면은 통신의 방향이며, 종종 메시지의 의미도 결정한다.  
가장 간단한 통신 패턴은 메시지가 소스에서 대상으로 한 방향으로 푸시되는 것이다.

![단방향 통신](https://prod-files-secure.s3.us-west-2.amazonaws.com/bc261f43-de91-483d-8946-ac5a65106576/36dc3706-e1fe-4836-a01b-5500bba8b165/Untitled.png)

단방향 통신

단방향 통신의 일반적인 예는 WebSocket을 사용하여 연결된 브라우저에 메시지를 보내는 이메일, 웹 서버 혹은 일련의 작업자에게 작업을 배포하는 시스템이다.

그리고 한 방향의 메시지가 항상 반대 방향의 메시지와 한 쌍을 이루는 요청/응답 교환 패턴이 있다.  
이 메시지 교환 패턴의 전형적인 예는 웹 서비스를 호출하거나 데이터베이스에 쿼리를 보내는 것이다.

![요청/응답 메시지 교환 패턴](https://prod-files-secure.s3.us-west-2.amazonaws.com/bc261f43-de91-483d-8946-ac5a65106576/42ee00dc-f407-4f5b-8ddd-6f52ea9ee860/Untitled.png)

요청/응답 메시지 교환 패턴

요청/응답 패턴을 구현하는 것이 사소하게 보일 수 있겠지만 통신 채널이 비동기적이거나 여러 노드를 포함하는 경우 더 복잡해진다.

![멀티노드 요청/응답 통신](https://prod-files-secure.s3.us-west-2.amazonaws.com/bc261f43-de91-483d-8946-ac5a65106576/1ac13406-5486-4c7c-a8be-7ed8283b0e18/Untitled.png)

멀티노드 요청/응답 통신

위 그림을 보면 각각의 두 노드 사이의 통신 방향을 고려하면 확실히 단방향 통신이라고 말할 수 있다.  
그러나 전체 관점에서 메시지 생성자는 요청을 보낸 후 해당 요청에 대한 다른 노드가 보낸 응답도 수신한다.  
이와 같은 상황에서 요청/응답 패턴과 순수 단방향 루프의 차이점은 요청과 응답 사이의 관계로, 이것은 메시;지 생성자에 달려있다.  
응답은 일반적으로 요청과 동일한 컨텍스트에서 처리된다.

## 13-1-2 메시지 유형

메시지는 본질적으로 서로 다른 소프트웨어 컴포넌트들을 연결하는 수단이며, 그렇게 하는 데에는 여러 가지 이유가 있다 .  
다른 시스템이나 컴포넌트가 보유한 일부 정보를 얻거나, 원격으로 작업을 실행하거나, 일부 피어(peer)들에게 방금 무엇인가가 발생했음을 알리기 위한 것일 수도 있다.  
메시지 내용도 통신의 이유에 따라 달라진다.  
일반적으로 목적에 따라 세 가지 유형의 메시지를 식별할 수 있다.

- 명령(Command) 메시지
- 이벤트(Event) 메시지
- 문서(Document) 메시지

### 명령 메시지

**명령 메시지**는 본질적으로 직렬화된 명령 객체이다.
이러한 유형의 메시지의 목적은 수신자에서의 작업 또는 작업의 실행을 트리거하는 것이다.  
이를 가능하게 하려면 명령 메시지에 작업을 실행하는데 필요한 필수 정보가 포함되어야 한다.  
여기에는 일반적으로 작업의 이름과 인자의 목록이 포함된다.

명령 메시지는 **원격 프로시저 호출(RPC)** 시스템, 분산 컴퓨팅을 구현하는데 사용되거나, 간단하게는 어떤 데이터를 요청하는데 사용할 수 있다.  
간단한 예로 RESTful HTTP 명령을 예로들 수 있다.  
각 HTTP 요청메서드(HTTP Verb)는 특정 의미를 가지며 정확한 작업과 연결된다.  
GET은 리소스의 검색, POST는 새로운 데이터의 생성, PUT/PATCH는 업데이터, DELETE는 삭제 작업을 말한다.

### 이벤트 메시지

**이벤트 메시지**는 무엇인가 발생했음을 다른 컴포넌트에 알리는데 사용된다.  
일반적으로 이벤트 유형과 컨텍스트, 주제 또는 관련된 행위자와 같은 세부 정보도 포함된다.  
웹 개발 시 예를 들면, WebSocket을 활용하여 서버에서 클라이언트로 알림을 보내 시스템 상태의 일부 데이터나 변경 사항을 전달할 경우 이벤트 메시지를 사용한다.  
이벤트는 시스템의 모든 노드를 동일한 페이지에 머물 수 있도록 하므로, 분산 애플리케이션에서 매우 중요한 메커니즘이다.

### 문서(Document) 메시지

**문서 메시지**는 주로 컴포넌트들과 머신들 사이에 데이터 전송을 위한 것이다.  
일반적인 예로는 데이터베이스 쿼리 결과를 전송하는데 사용되는 메시지이다.

문서 메시지를 명령 메시지(데이터를 포함할 수도 있음)와 구분하는 주요 특징은 메시지에 데이터로 수행할 작업을 수신자에게 알려주는 정보가 포함되어 있지 않다는 것이다.

반면에 문서 메시지와 이벤트 메시지의 중요한 차이점은 발생한 특정 사건과 연관성이 없다는 것이다.  
명령 메시지에 대한 응답은 일반적으로 요청된 데이터 또는 작업 결과만 포함하므로 문서 메시지이다.
