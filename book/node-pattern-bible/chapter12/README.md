# 12. 확장성 및 구조적 패턴(확장성과 아키텍처 패턴)

초기 Node.js는 C++ 및 JavaScript로 작성된 논 블로킹 웹 서버였다. 제작자인 Ryan Dahl은 플랫폼의 잠재력을 깨닫고 JavaScript 및 논 블로킹 패터다임을 기반으로 다양한 유형의 서버 측 애플리케이션을 만들 수 있는 도구로 확장하기 시작했다.

Node.js의 특성은 몇 개의 노드에서 수천 개의 노드에 이르기까지 네트워크를 통해 통신하는 **분산 시스템의 구현에 완벽하다**.
Node.js는 분산을 위해 생겨났다.

다른 웹 플랫폼과 달리 **확장성**은 애플리케이션을 개발하는 동안 Node.js에서 상당히 빠르게 당면하는 주제인데, 이는 Node.js의 단일 스레드 속성 때문이며, 이는 멀티 코어 시스템의 모든 리소스를 활용할 수 없다.
하지만 실제로 Node.js와 함께 확장성에 대해 논의하는 데에는 더 깊은 이유가 있다.

애플리케이션 확장은 용량을 늘려서 더 많은 요청을 더 빠르게 처리할 수 있다는 것을 의미할 뿐만 아니라 [고가용성](https://ko.wikipedia.org/wiki/%EA%B3%A0%EA%B0%80%EC%9A%A9%EC%84%B1)과 오류에 대한 내성을 달성하기 위한 중요한 방법이기도 하다.
때로는 애플리케이션의 복잡성을 관리하기 쉬운 부분으로 분할하는 방법에 대해 이야기할 때 확장성을 언급하기도 한다.
확장성은 정육면체에 있는 면 수만큼 많은 측면이 존재하는 개념이다.

이 장에서 학습하게 될 내용은 다음과 같다.

- 확장성에 관심을 가져야 하는 이유
- 스케일 큐브의 정의 및 확장성을 이해하는 것이 유용한 이유
- 동일한 애플리케이션의 여러 인스턴스를 실행하여 확장하는 방법
- 애플리케이션을 확장할 때 로드 밸런서를 활용하는 방법
- 서비스 레지스트리의 정의 및 사용 방법
- 쿠버네티스와 같은 컨테이너 오케스트레이션 플랫폼을 사용하여 Node.js 애플리케이션 실행 및 확장
- 모놀리식 애플리케이션에서 마이크로서비스 아키텍처를 설계하는 방법
- 몇 가지 간단한 아키텍처 패턴을 사용하여 많은 서비스를 통합하는 방법

## 12-1-2 확장성 3차원

확장성에 대해 이야기할 때, 이해해야 하는 첫 번째 기분 원칙은 부하 분산이다.  
부하 분산은 여러 프로세스와 머신에 걸쳐 애플리케이션의 로드를 분할하는 과학이다.  
이를 달성하기 위한 많은 방법들이 있으며, 그 중에 스케일 큐브라는 게 있다.

- x 축 : 복제
- y 축 : 서비스/기능별 분해
- z 축 : 데이터 파티션으로 분할

![스케일 큐브](https://prod-files-secure.s3.us-west-2.amazonaws.com/bc261f43-de91-483d-8946-ac5a65106576/d98d4764-3ac1-4225-976e-cd005eb85384/Untitled.png)

스케일 큐브

모놀로식, 단일 인스턴스 애플리케이션 - 단일 코드 기반에 모든 기능이 있고, 단일 인스턴스에서 실행되는 애플리케이션을 나타낸다. 이것을 일반적으로 모놀리식 애플리케이션이라고 부른다.  
이는 소규모 부하를 처리하거나 개발 초기 단계에 있는 애플리케이션의 경우 확장을 위한 세가지 전략이 있다.

- X 축 - 복제 :  
  모놀리식 비확장 애플리케이션의 가장 직관적인 진화는 X축을 따라 바로 이동하는 것이다.  
  이는 간단하고 대부분 시간 비용이 저렴하고(개발 비용 측면에서) 매우 효과적이다.  
  이 기술의 기본 원리는 동일한 애플리케이션을 n번 복제하고, 각 인스턴스가 1/n의 부하를 처리할 수 있도록 하는 것이다.
- Y축 - 서비스/기능 별로 분해 :  
  Y축을 따라 확장한다는 것은 기능, 서비스 또는 사용 사례에 따라 애플리케이션을 분해하는 것을 의미한다.  
  이 경우 분해는 각각 고유한 코드 기반을 사용하는 다른 독립형 애플리케이션을 만드는 것을 의미한다.  
  (예: 사용자 인증을 담당하는 서비스를 추출하여 전용 인증 서버를 만드는 것)  
  기능별로 애플리케이션을 분할하는 기준은 비즈니스 요구사항, 사용 사례, 데이터 및 기타 여러 요인에 따라 달라진다.  
  이것은 애플리케이션의 아키텍처 뿐만 아니라 개발 및 운영 관점에서 관리되는 방식에도 큰 영향을 미치는 확장 차원이다.  
  마이크로서비스는 세분화된 Y축 확장과 일반적으로 가장 관련된 용어이다.
- X축 - 데이터 파티션으로 분할 :  
  각 인스턴스가 전체 데이터의 일부만 담당하는 방식으로 애플리케이션이 분할된다.  
  이는 **수평/수직 분할**이라고도 하는데, 데이터베이스에서 자주 사용되는 기술이다.  
  이 설정에는 동일한 애플리케이션의 여러 인스턴스가 있으며, 각 인스턴스는 서로 다른 기준을 사용하여 결정되는 데이터 파티션에서 작동한다.  
  예를 들어 국가(목록분할) 또는 이름의 성을 기준으로(범위 분할) 애플리케이션 사용자를 분할하거나 해시 함수가 각 사용자가 속한 분할 영역을 결정하도록 할 수 있다(해시 분할).  
  그런 다음, 각 파티션을 애플리케이션의 특정 인스턴스에 할당할 수 있다.  
  데이터 파티션을 사용하려면 지정된 데이터를 담당하는 애플리케이션 인스턴스를 판별하기 위한 조회 단계가 선행되어야 한다.  
  데이터 파티셔닝은 대규모 모놀리식 데이터 셋(제한된 디스코 공간, 메모리 및 네트워크 용량) 처리와 관련된 문제를 해결하는 것이 주 목적이기 때문에 일반적으로 데이터 스토리지 수준에서 적용 및 처리된다.  
  애플리케이션 수준에서 적용하는 것은 복잡한 분산형 아키텍처 또는 데이터의 지속성을 위해 외부 솔루션에 의존하는 애플리케이션을 만드는 경우, 파티셔닝을 지원하지 않는 데이터베이스를 사용하는 경우, Google 스케일에서 애플리케이션을 만드는 경우와 같이 매우 특별한 사용 사례에서만 고려할 가치가 있다.
